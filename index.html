<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <title>Please choose your priorities.</title>
  <style>
    :root {
      --bg-dark: oklch(0.1 0.04 234);
      --bg: oklch(0.15 0.04 234);
      --bg-light: oklch(0.2 0.04 234);
      --text: oklch(0.96 0.08 234);
      --text-muted: oklch(0.76 0.08 234);
      --highlight: oklch(0.5 0.08 234);
      --border: oklch(0.4 0.08 234);
      --border-muted: oklch(0.3 0.08 234);
      --primary: oklch(0.76 0.1 234);
      --yellow-bg-dark: hsl(15 100% 2%);
      --yellow-bg: hsl(30 100% 3%);
      --yellow-bg-light: hsl(42 100% 4%);
      --yellow-text: hsl(49 100% 83%);
      --yellow-text-muted: hsl(49 44% 58%);
      --yellow-highlight: hsl(49 100% 13%);
      --yellow-border: hsl(46 100% 9%);
      --yellow-border-muted: hsl(40 100% 7%);
      --yellow-primary: hsl(52 100% 30%);
    }

    body.light {
      --bg-dark: oklch(0.92 0.04 234);
      --bg: oklch(0.96 0.04 234);
      --bg-light: oklch(1 0.04 234);
      --text: oklch(0.15 0.08 234);
      --text-muted: oklch(0.4 0.08 234);
      --highlight: oklch(1 0.08 234);
      --border: oklch(0.6 0.08 234);
    }

    body {
      font-family: Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 40px;
      user-select: none;
      transition: background 0.3s, color 0.3s;
    }

    #themeToggle {
      padding: 10px 20px;
      margin-bottom: 20px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s, color 0.3s, transform 0.2s, box-shadow 0.2s;
      background: linear-gradient(145deg, var(--border-muted), var(--bg-light));
      color: var(--text);
      box-shadow: 0 3px 8px rgba(0,0,0,0.08);
    }
    body.light #themeToggle { background: linear-gradient(145deg, var(--bg-light), var(--bg)); }
    #themeToggle:hover { transform: scale(1.05); background: linear-gradient(145deg, var(--highlight), var(--primary)); box-shadow: 0 15px 25px rgba(0,0,0,0.25); }

    input, textarea, button {
      font-family: inherit;
      outline: none;
    }

    #userName, #commentBox {
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid var(--border-muted);
      background: var(--bg-light);
      color: var(--text);
      font-size: 0.9rem;
      width: 100%;
      box-sizing: border-box;
      margin-top: 5px;
      margin-bottom: 10px;
      transition: border 0.2s, box-shadow 0.2s;
    }

    #userName:focus, #commentBox:focus { border-color: var(--highlight); box-shadow: 0 0 6px var(--highlight); }

    #submitBtn {
      padding: 6px 12px;
      border-radius: 8px;
      background: var(--highlight);
      color: var(--text);
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.2s, transform 0.2s;
    }
    #submitBtn:hover { background: var(--primary); transform: scale(1.05); }

    .cards-row {
      display: flex;
      gap: 20px;
      justify-content: center;
      align-items: flex-start;
      flex-wrap: wrap;
    }

    .card-container { flex: 1 1 400px; max-width: 400px; width: 100%; display: flex; flex-direction: column; gap: 15px; position: relative; }

    .card { position: relative; padding: 20px; border-radius: 12px; background: var(--bg-light); box-shadow: 0 3px 8px rgba(0,0,0,0.08); transition: transform 0.2s ease; }
    .card h3 { margin: 0 0 5px 0; color: var(--text); }
    .card p { margin: 0; color: var(--text-muted); }

    .card.yellow { background: var(--yellow-bg-light); color: var(--yellow-text); border: 1px solid var(--yellow-border); }
    .card.yellow h3 { color: var(--yellow-text); }
    .card.yellow p { color: var(--yellow-text-muted); }

    .rank { position: absolute; top: 10px; right: 15px; font-weight: bold; font-size: 18px; background: var(--highlight); color: var(--text); padding: 4px 8px; border-radius: 8px; }

    .card.yellow .rank { color: var(--yellow-text); background: var(--yellow-highlight); }
    .card.yellow.dragging { pointer-events: none; opacity: 0.95; box-shadow: 0 15px 25px rgba(0,0,0,0.25); }

    .dragging { position: absolute; z-index: 1000; pointer-events: none; opacity: 0.95; width: 100%; box-shadow: 0 15px 25px rgba(0,0,0,0.25); transition: none; }

    #leaderboard { margin-top: 30px; }

    @media (max-width: 900px) { .cards-row { flex-direction: column; gap: 15px; } }
    @media (max-width: 480px) { body { padding: 20px; } h1 { font-size: 1.2rem; } #userName, #submitBtn, #themeToggle { font-size: 0.85rem; padding: 6px 10px; } .rank { font-size: 16px; padding: 3px 6px; } }
  </style>
</head>
<body>

<button id="themeToggle">Toggle Theme</button>

<h1>Rank These Items</h1>
<input type="text" id="userName" placeholder="Your name/nickname">

<p>Drag to reorder. 1 Should Be Most Important.</p>

<div class="cards-row">
  <div class="card-container" id="cardContainer">
    <div class="card"><div class="rank"></div><h3>Observing & Noticing</h3><p>Carefully noticing features, patterns and changes in the world.<br>• Use senses to notice details.<br>• Observe changes over time.<br>• Compare objects, materials or organisms.<br>• Record observations using drawings, photos or simple notes</p></div>
    <div class="card"><div class="rank"></div><h3>Questioning & Curiosity</h3><p>Asking questions that lead to inquiry and deeper understanding.<br>• Ask simple 'why' and 'how' questions.<br>• Generate testable questions.<br>• Identify questions that can be investigated scientifically.<br>• Refine questions using evidence or prior knowledge.</p></div>
    <div class="card"><div class="rank"></div><h3>Planning Investigations</h3><p>Designing methods to collect reliable, fair and meaningful data.<br>• Decide what to change, measure and keep the same.<br>• Select equipment and materials appropriately.<br>• Plan steps for an investigation.<br>• Identify risks and how to manage them.</p></div>
    <div class="card"><div class="rank"></div><h3>Measuring & Data Collection</h3><p>Gathering accurate, reliable data using tools and techniques.<br>• Using appropriate equipment correctly.<br>• Choose appropriate units of measurement.<br>• Make repeated measurements for accuracy.<br>• Use digital tools (sensors, probes) to collect data.</p></div>
  </div>

  <div class="card-container yellow" id="yellowCardContainer">
    <div class="card yellow"><div class="rank"></div><h3>Yellow Card 1</h3><p>Details for yellow card 1.</p></div>
    <div class="card yellow"><div class="rank"></div><h3>Yellow Card 2</h3><p>Details for yellow card 2.</p></div>
  </div>
</div>

<h2>Comment</h2>
<p>Comment You can include an optional comment</p>
<textarea id="commentBox" placeholder="Comment" rows="4"></textarea>

<button id="submitBtn">Submit</button>

<div id="leaderboard"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCFuF9IGUQXo6y_3DS6yK7sUsRPGvubLec",
  authDomain: "cardrank-8902d.firebaseapp.com",
  projectId: "cardrank-8902d",
  storageBucket: "cardrank-8902d.firebasestorage.app",
  messagingSenderId: "239434202509",
  appId: "1:239434202509:web:cedc422c1de2cd2c4211c4"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Theme
if (!window.matchMedia('(prefers-color-scheme: dark)').matches) document.body.classList.add('light');
document.getElementById('themeToggle').addEventListener('click', () => document.body.classList.toggle('light'));

// Drag-and-drop logic (same as your previous code, works for both blue and yellow cards)
const cardContainers = [document.getElementById('cardContainer'), document.getElementById('yellowCardContainer')];
cardContainers.forEach(container => {
  let dragged = null, offsetY = 0, placeholderIndex = 0;
  function updateRanks() { container.querySelectorAll('.card').forEach((c,i)=>c.querySelector('.rank').textContent=i+1); }
  updateRanks();
  function startDrag(e, card){ dragged=card; const rect=card.getBoundingClientRect(); const clientY=e.touches?e.touches[0].clientY:e.clientY; offsetY=clientY-rect.top; dragged.style.width=`${rect.width}px`; dragged.style.height=`${rect.height}px`; dragged.style.position='absolute'; dragged.style.zIndex=1000; dragged.style.left=`${rect.left+window.scrollX}px`; dragged.style.top=`${rect.top+window.scrollY}px`; dragged.classList.add('dragging'); document.body.appendChild(dragged); e.preventDefault(); }
  function moveDrag(e){ if(!dragged)return; const clientY=e.touches?e.touches[0].clientY:e.clientY; dragged.style.top=`${clientY-offsetY+window.scrollY}px`; const cards=Array.from(container.children).filter(c=>c!==dragged); cards.forEach(c=>{ const rect=c.getBoundingClientRect(); const middle=rect.top+rect.height/2+window.scrollY; const draggedIndex=Array.from(container.children).indexOf(dragged); const cIndex=Array.from(container.children).indexOf(c); let transformY=0; if(clientY+window.scrollY<middle&&cIndex<draggedIndex)transformY=rect.height+15; if(clientY+window.scrollY>middle&&cIndex>draggedIndex)transformY=-(rect.height+15); const current=parseFloat(c.style.transform.replace(/translateY\((.*)px\)/,'$1'))||0; c.style.transform=`translateY(${current+(transformY-current)*0.2}px)`; }); const cardRects=Array.from(container.children).map(c=>c.getBoundingClientRect()); placeholderIndex=cardRects.findIndex(r=>clientY+window.scrollY<r.top+r.height/2+window.scrollY); if(placeholderIndex===-1)placeholderIndex=container.children.length; }
  function endDrag(){ if(!dragged)return; const children=Array.from(container.children); container.insertBefore(dragged, children[placeholderIndex]||null); dragged.classList.remove('dragging'); dragged.style.position=''; dragged.style.width=''; dragged.style.height=''; dragged.style.left=''; dragged.style.top=''; dragged.style.zIndex=''; container.querySelectorAll('.card').forEach(c=>c.style.transform=''); dragged=null; updateRanks(); }
  container.querySelectorAll('.card').forEach(card=>{ card.addEventListener('mousedown', e=>startDrag(e, card)); card.addEventListener('touchstart', e=>startDrag(e, card), {passive:false}); });
  document.addEventListener('mousemove', moveDrag); document.addEventListener('touchmove', moveDrag,{passive:false}); document.addEventListener('mouseup', endDrag); document.addEventListener('touchend', endDrag);
});

// Submission
const submitBtn = document.querySelector('#submitBtn');
submitBtn.addEventListener('click', async () => {
  const name = document.querySelector('#userName').value.trim();
  const comment = document.querySelector('#commentBox').value.trim();
  if(!name){ alert("Please enter your name!"); return; }
  const qSnap = await getDocs(query(collection(db,"submissions"), where("name","==",name)));
  if(!qSnap.empty){ alert("Name already used!"); return; }

  const priorities = Array.from(document.getElementById('cardContainer').children).map(c=>c.querySelector('h3').textContent);
  const yellowPriorities = Array.from(document.getElementById('yellowCardContainer').children).map(c=>c.querySelector('h3').textContent);

  await addDoc(collection(db,"submissions"), { name, priorities, yellowPriorities, comment });

  alert(`Thanks ${name}! Your priorities were submitted.`);
  document.querySelector('#userName').value = '';
  document.querySelector('#commentBox').value = '';
});

// Leaderboard
const leaderboardDiv = document.getElementById('leaderboard');
onSnapshot(collection(db,"submissions"), () => {
  leaderboardDiv.innerHTML = '';
  getDocs(collection(db,"submissions")).then(snapshot=>{
    snapshot.forEach(doc=>{
      const data=doc.data();
      const div=document.createElement('div');
      div.textContent=`${data.name}: ${data.priorities.join(', ')} | ${data.yellowPriorities.join(', ')} | Comment: ${data.comment||''}`;
      leaderboardDiv.appendChild(div);
    });
  });
});
</script>

</body>
</html>
