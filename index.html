<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>12 Card Ranking - Smooth Drag</title>
<style>
:root {
  /* dark theme (default) */
  --bg-dark: oklch(0.1 0.04 234);
  --bg: oklch(0.15 0.04 234);
  --bg-light: oklch(0.2 0.04 234);
  --text: oklch(0.96 0.08 234);
  --text-muted: oklch(0.76 0.08 234);
  --highlight: oklch(0.5 0.08 234);
  --border: oklch(0.4 0.08 234);
  --border-muted: oklch(0.3 0.08 234);
  --primary: oklch(0.76 0.1 234);
}
body.light {
  --bg-dark: oklch(0.92 0.04 234);
  --bg: oklch(0.96 0.04 234);
  --bg-light: oklch(1 0.04 234);
  --text: oklch(0.15 0.08 234);
  --text-muted: oklch(0.4 0.08 234);
  --highlight: oklch(1 0.08 234);
  --border: oklch(0.6 0.08 234);
}
body {
  font-family: Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
  padding: 40px;
  user-select: none;
  transition: background 0.3s, color 0.3s;
}
h1 { margin-bottom: 10px; color: var(--text); display:flex; align-items:center; gap:10px; flex-wrap:wrap;}
p { color: var(--text-muted); }
#themeToggle { padding: 10px 20px; margin-bottom: 20px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; transition: background 0.3s, color 0.3s, transform 0.2s, box-shadow 0.2s; background: linear-gradient(145deg, var(--border-muted), var(--bg-light)); color: var(--text); box-shadow: 0 3px 8px rgba(0,0,0,0.08); }
body.light #themeToggle { background: linear-gradient(145deg, var(--bg-light), var(--bg)); color: var(--text); }
#themeToggle:hover { transform: scale(1.05); background: linear-gradient(145deg, var(--highlight), var(--primary)); box-shadow: 0 15px 25px rgba(0,0,0,0.25); }

.card-container { display: flex; flex-direction: column; gap: 15px; max-width: 400px; position: relative; }
.card { position: relative; padding: 20px; border-radius: 12px; background: var(--bg-light); box-shadow: 0 3px 8px rgba(0,0,0,0.08); transition: transform 0.2s ease; }
.card h3 { color: var(--text); margin: 0 0 5px 0; }
.card p { color: var(--text-muted); margin: 0; }
.rank { position: absolute; top: 10px; right: 15px; font-weight: bold; font-size: 18px; background: var(--highlight); color: var(--text); padding: 4px 8px; border-radius: 8px; }
.dragging { position: absolute; z-index: 1000; pointer-events: none; opacity: 0.95; width: 400px; box-shadow: 0 15px 25px rgba(0,0,0,0.25); transition: none; }
#leaderboard { margin-top: 30px; }
</style>
</head>
<body>

<button id="themeToggle">Toggle Theme</button>

<h1>
  Rank These Items
  <input type="text" id="userName" placeholder="Your name">
  <button id="submitBtn">Submit</button>
</h1>
<p>Drag to reorder. 1 = Most Important.</p>

<div class="card-container" id="cardContainer">
  <div class="card"><div class="rank"></div><h3>Card 1</h3><p>I don’t know what to put here!</p></div>
  <div class="card"><div class="rank"></div><h3>Card 2</h3><p>Description text here.</p></div>
  <div class="card"><div class="rank"></div><h3>Card 3</h3><p>Description text here.</p></div>
  <div class="card"><div class="rank"></div><h3>Card 4</h3><p>Description text here.</p></div>
  <div class="card"><div class="rank"></div><h3>Card 5</h3><p>What’s this for?</p></div>
  <div class="card"><div class="rank"></div><h3>Card 6</h3><p>Description text here.</p></div>
  <div class="card"><div class="rank"></div><h3>Card 7</h3><p>Description text here.</p></div>
  <div class="card"><div class="rank"></div><h3>Card 8</h3><p>Hi!!!!</p></div>
  <div class="card"><div class="rank"></div><h3>Card 9</h3><p>Description text here.</p></div>
  <div class="card"><div class="rank"></div><h3>Card 10</h3><p>Description text here.</p></div>
  <div class="card"><div class="rank"></div><h3>Card 11</h3><p>Description text here.</p></div>
  <div class="card"><div class="rank"></div><h3>Card 12</h3><p>Description text here.</p></div>
</div>

<h2>Leaderboard</h2>
<div id="leaderboard"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyCFuF9IGUQXo6y_3DS6yK7sUsRPGvubLec",
  authDomain: "cardrank-8902d.firebaseapp.com",
  projectId: "cardrank-8902d",
  storageBucket: "cardrank-8902d.firebasestorage.app",
  messagingSenderId: "239434202509",
  appId: "1:239434202509:web:cedc422c1de2cd2c4211c4"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Theme toggle
const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
if (!prefersDark) document.body.classList.add('light');
const toggleBtn = document.getElementById('themeToggle');
toggleBtn.addEventListener('click', ()=>{ document.body.classList.toggle('light'); });

// Drag-and-drop logic
const container = document.getElementById('cardContainer');
let dragged=null, mouseOffsetY=0, placeholderIndex=0;

function updateRanks(){ container.querySelectorAll('.card').forEach((c,i)=>c.querySelector('.rank').textContent=i+1); }
updateRanks();

container.querySelectorAll('.card').forEach(card=>{
  card.addEventListener('mousedown', e=>{
    dragged=card;
    const rect=card.getBoundingClientRect();
    mouseOffsetY=e.clientY-rect.top;
    dragged.style.width=`${rect.width}px`;
    dragged.style.height=`${rect.height}px`;
    dragged.classList.add('dragging');
    document.body.appendChild(dragged);
  });
});

document.addEventListener('mousemove', e=>{
  if(!dragged) return;
  dragged.style.top=`${e.pageY - mouseOffsetY}px`;
  dragged.style.left=`${container.getBoundingClientRect().left + window.scrollX}px`;

  const cards=Array.from(container.children).filter(c=>c!==dragged);
  cards.forEach(c=>{
    const rect=c.getBoundingClientRect();
    const middle=rect.top+rect.height/2;
    let transformY=0;
    const draggedIndex=Array.from(container.children).indexOf(dragged);
    const cIndex=Array.from(container.children).indexOf(c);
    if(e.clientY<middle && cIndex<draggedIndex) transformY=rect.height+15;
    if(e.clientY>middle && cIndex>draggedIndex) transformY=-(rect.height+15);
    const current=parseFloat(c.style.transform.replace(/translateY\((.*)px\)/,'$1'))||0;
    c.style.transform=`translateY(${current + (transformY-current)*0.2}px)`;
  });

  const cardRects=Array.from(container.children).map(c=>c.getBoundingClientRect());
  placeholderIndex=cardRects.findIndex(r=>e.clientY<r.top+r.height/2);
  if(placeholderIndex===-1) placeholderIndex=container.children.length;
});

document.addEventListener('mouseup', ()=>{
  if(!dragged) return;
  const children=Array.from(container.children);
  container.insertBefore(dragged, children[placeholderIndex]||null);
  dragged.classList.remove('dragging');
  dragged.style.position=''; dragged.style.width=''; dragged.style.height=''; dragged.style.top=''; dragged.style.left=''; dragged.style.transform='';
  container.querySelectorAll('.card').forEach(c=>c.style.transform='');
  dragged=null; updateRanks();
});

// Submission and live leaderboard
const submitBtn=document.getElementById('submitBtn');
const userNameInput=document.getElementById('userName');
const leaderboardDiv=document.getElementById('leaderboard');

async function loadLeaderboard(){
  const snapshot = await getDocs(collection(db,"submissions"));
  leaderboardDiv.innerHTML='';
  snapshot.forEach(doc=>{
    const data=doc.data();
    const div=document.createElement('div');
    div.textContent=`${data.name}: ${data.priorities.join(', ')}`;
    leaderboardDiv.appendChild(div);
  });
}

// Real-time leaderboard updates
onSnapshot(collection(db,"submissions"), ()=>{ loadLeaderboard(); });

submitBtn.addEventListener('click', async ()=>{
  const name=userNameInput.value.trim();
  if(!name){ alert("Please enter your name!"); return; }

  // Duplicate check
  const q=query(collection(db,"submissions"), where("name","==",name));
  const snapshot = await getDocs(q);
  if(!snapshot.empty){ alert("Someone already used this name!"); return; }

  // Get priorities
  const priorities=Array.from(container.children).map(c=>c.querySelector('h3').textContent);

  await addDoc(collection(db,"submissions"),{name,priorities});
  alert(`Thanks ${name}! Your priorities were submitted.`);
  userNameInput.value='';
});
</script>

</body>
</html>
